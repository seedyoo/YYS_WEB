<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX 로 요청하기</title>
    
</head>
<body>
    
    <h1>AJAX 요청하기</h1>

    <label for="boardNo">게시글 번호</label>
    <input type="text" name="boardNo" id="boardNo">
    <button onclick="getBoard()">게시글 조회</button>
    <hr>
    <div>
        <h3><span>제목 : </span><span id="title"></span></h3>
        <h5><span>작성자 : </span><span id="writer"></span></h5>
        <textarea name="" id="content" cols="50" rows="10" readonly></textarea>
    </div>

    <hr>

    <h3>게시글 목록</h3>

    <table border="1">
        <tr>
            <th width="50">번호</th>
            <th width="300">제목</th>
            <th width="100">작성자</th>
            <th width="200">등록일자</th>
            <th width="200">수정일자</th>
        </tr>
        <tr id="empty">
            <td colspan="5" align="center">조회된 내역이 없습니다.</td>
        </tr>
        <div id="board-list"></div>
    </table>



    <script>

        getList() 

        // 게시글 조회 요청
        function getBoard() {
            // XMLHttpRequest 객체 생성
            let request = new XMLHttpRequest()

            // 응답 확인
            request.onreadystatechange = function() {
                // request.readyState : 클라이언트의 준비 상태 변수
                // - UNSENT     : open() 호출 전
                // - OPENED     : open() 호출된 상태
                // - LOADING    : 응답 데이터를 가져오고 있는 상태
                // - DONE       : 요청 완료

                // requeset.status      : 응답 상태 코드
                // ex) 200, 404, 500
                // 요청 완료 시, 성공적으로 처리되었을 때
                if( request.readyState == request.DONE && request.status == 200 ) {
                    // request.responseText : 응답 데이터
                    let response = request.responseText
                    // JSON.parse() : text --> JSON 변환
                    let board = JSON.parse(response)
                    // alert(board)
                    // 데이터 화면에 출력하기
                    let title = document.getElementById('title')
                    let writer = document.getElementById('writer')
                    let content = document.getElementById('content')

                    title.innerText = board.title
                    writer.innerText = board.writer
                    content.value = board.content
                }
            }

            let boardNo = document.getElementById('boardNo').value
            let url = "http://192.168.0.44:8080/api/board/" + boardNo

            // request.open("요청메소드", url, 비동기여부)
            // - 요청에 필요한 설정을 초기화하는 메소드
            request.open("GET", url, true)

            // setRequestHeader("헤더속성", "값")
            // - 요청헤더를 지정하는 메소드
            request.setRequestHeader("Content-Type", "application/json")

            // request.send(데이터)
            // - 요청을 전송하는 메소드
            request.send()
        }

        // 게시글 목록 요청
        function getList() {
            let request = new XMLHttpRequest()

            // 응답 확인
            request.onreadystatechange = function() {

                if( request.readyState == request.DONE && request.status == 200 ) {
                    let response = request.responseText
                    // JSON.parse() : text --> JSON 변환
                    let boardList = JSON.parse(response)

                    console.log(boardList)
                    
                    for (const board of boardList) {
                        console.log(board.title)
                        console.log(board.content)
                        console.log(board.writer)
                    }

                }
            }

            let url = "http://192.168.0.44:8080/api/board"

            request.open("GET", url, true)
            request.setRequestHeader("Content-Type", "application/json")
            request.send()
        }

    </script>
</body>
</html>